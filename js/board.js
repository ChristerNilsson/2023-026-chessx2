// Generated by CoffeeScript 2.5.1
var modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

import _ from 'https://cdn.skypack.dev/lodash';

import {
  ass,
  lerp,
  param,
  range,
  hexToBase64,
  enterFullscreen
} from '../js/utils.js';

import {
  Square
} from '../js/square.js';

import {
  Button
} from '../js/button.js';

import {
  coords,
  global,
  toObjectNotation,
  toUCI
} from '../js/globals.js';

import {
  dumpState
} from '../js/globals.js';

export var Board = class Board {
  constructor(nr) {
    var i, k, len, ref;
    this.click = this.click.bind(this);
    this.draw = this.draw.bind(this);
    this.drawClock = this.drawClock.bind(this);
    this.littera = this.littera.bind(this);
    this.nr = nr;
    this.squares = [];
    this.clickedSquares = [];
    this.pieces = "";
    ref = range(64);
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      ((i) => {
        return this.squares.push(new Square(this.nr, i, () => {
          return this.click(i);
        }));
      })(i);
    }
    this.buttons = [];
  }

  click(i) {
    var col, color, csl, g, row, sq, uci;
    g = global;
    if (this.nr === modulo(g.chess.history().length, 2)) {
      return;
    }
    col = modulo(i, 8);
    row = 7 - Math.floor(i / 8);
    sq = g.chess.board()[row][col];
    color = "wb"[modulo(g.chess.history().length, 2)];
    csl = this.clickedSquares.length;
    if (csl === 0) {
      if (sq !== null && sq.color === color) {
        return this.clickedSquares.push(i);
      }
    } else if (csl === 1) {
      if (i === this.clickedSquares[0]) {
        return this.clickedSquares = []; // kontrollera draget
      } else {
        this.clickedSquares.push(i);
        uci = toUCI(this.clickedSquares);
        // är detta ett korrekt drag? I så fall, utför det
        if (g.chess.move({
          from: uci.slice(0, 2),
          to: uci.slice(2, 4)
        })) {
          this.clickedSquares = [];
          console.log(g.chess);
          if (g.chess.game_over()) {
            g.paused = true;
          }
          return g.clocks[modulo(g.chess.history().length, 2)] += g.increment;
        } else {
          return this.clickedSquares.pop();
        }
      }
    }
  }

  draw() {
    var SIZE, button, i, j, k, l, len, len1, len2, m, piece, ref, ref1, ref2, ref3, ref4, ref5, sq;
    ref = this.buttons;
    for (k = 0, len = ref.length; k < len; k++) {
      button = ref[k];
      button.draw();
    }
    fill('white');
    textSize(global.size() * 0.3);
    push();
    if (this.nr === 0) {
      translate(global.mx(), global.my());
    } else {
      translate(global.mx(), global.my() + 9 * global.size());
    }
    ref1 = range(8);
    for (l = 0, len1 = ref1.length; l < len1; l++) {
      i = ref1[l];
      ref2 = range(8);
      for (m = 0, len2 = ref2.length; m < len2; m++) {
        j = ref2[m];
        piece = global.chess.board()[7 - i][j];
        sq = this.squares[i * 8 + j];
        if ((ref3 = this.clickedSquares.length) === 0 || ref3 === 2) {
          sq.draw(piece, false);
        }
        if ((ref4 = this.clickedSquares.length) === 1) {
          sq.draw(piece, i * 8 + j === this.clickedSquares[0]);
        } else if ((ref5 = this.clickedSquares.length) === 3 || ref5 === 4) {
          sq.draw(piece, i * 8 + j === this.clickedSquares[2]);
        }
      }
    }
    stroke('black');
    if (global.paused || this.nr === global.chess.history().length % 2) {
      fill(128, 128, 128, 64);
    } else {
      noFill();
    }
    SIZE = global.size();
    rect(SIZE * 4, SIZE * 4, SIZE * 8, SIZE * 8);
    pop();
    if (global.clocks[0] <= 0 || global.clocks[1] <= 0) {
      global.paused = true;
    }
    this.drawClock(0);
    return this.drawClock(1);
  }

  drawClock(player) {
    var minuter, p, res, sekunder, t, timmar;
    p = modulo(global.chess.history().length, 2);
    fill(["black", "white"][player]);
    if (global.clocks[player] < 60) {
      fill("red");
    }
    noStroke();
    textSize(global.size());
    t = global.clocks[player];
    if (!global.paused && p !== player) {
      t -= 1 / 120;
    }
    global.clocks[player] = t;
    t = round(t);
    sekunder = modulo(t, 60);
    t = Math.floor(t / 60);
    if (sekunder < 10) {
      sekunder = "0" + sekunder;
    }
    minuter = modulo(t, 60);
    if (minuter < 10) {
      minuter = "0" + minuter;
    }
    timmar = Math.floor(t / 60);
    if (timmar > 0) {
      res = timmar + "h" + minuter;
    } else {
      res = minuter + ":" + sekunder;
    }
    if (this.nr === 0) {
      push();
      translate(width - global.mx() / 2, global.size() * [2, 5][player]);
      scale(-1, -1);
      text(res, 0, 0);
      pop();
    }
    if (this.nr === 1) {
      return text(res, global.mx() / 2, global.size() * [13, 16][player]);
    }
  }

  littera() {
    var SIZE, digits, i, k, len, letters, ref, results;
    SIZE = global.size();
    noStroke();
    fill('black');
    textSize(SIZE * 0.3);
    letters = false ? "hgfedcba" : "abcdefgh";
    digits = false ? "12345678" : "87654321";
    ref = range(8);
    results = [];
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      text(letters[i], SIZE * (i + 1), SIZE * 8.8);
      results.push(text(digits[i], SIZE * 0.15, SIZE * (i + 1)));
    }
    return results;
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9hcmQuanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcYm9hcmQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBOztBQUFBLE9BQU8sQ0FBUCxNQUFBOztBQUNBLE9BQUE7RUFBUSxHQUFSO0VBQVksSUFBWjtFQUFpQixLQUFqQjtFQUF1QixLQUF2QjtFQUE2QixXQUE3QjtFQUF5QyxlQUF6QztDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLE1BQVI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxNQUFSO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsTUFBUjtFQUFlLE1BQWY7RUFBc0IsZ0JBQXRCO0VBQXVDLEtBQXZDO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsU0FBUjtDQUFBLE1BQUE7O0FBRUEsT0FBQSxJQUFhLFFBQU4sTUFBQSxNQUFBO0VBQ04sV0FBYSxHQUFBLENBQUE7QUFDZCxRQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBO1FBUUMsQ0FBQSxZQUFBLENBQUE7UUEwQkEsQ0FBQSxXQUFBLENBQUE7UUFpQ0EsQ0FBQSxnQkFBQSxDQUFBO1FBNkJBLENBQUEsY0FBQSxDQUFBO0lBakdjLElBQUMsQ0FBQTtJQUNkLElBQUMsQ0FBQSxPQUFELEdBQVc7SUFDWCxJQUFDLENBQUEsY0FBRCxHQUFrQjtJQUNsQixJQUFDLENBQUEsTUFBRCxHQUFVO0FBQ1Y7SUFBQSxLQUFBLHFDQUFBOztNQUNJLENBQUEsQ0FBQyxDQUFELENBQUEsR0FBQTtlQUFPLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBVCxDQUFjLElBQUksTUFBSixDQUFXLElBQUMsQ0FBQSxFQUFaLEVBQWdCLENBQWhCLEVBQW1CLENBQUEsQ0FBQSxHQUFBO2lCQUFHLElBQUMsQ0FBQSxLQUFELENBQU8sQ0FBUDtRQUFILENBQW5CLENBQWQ7TUFBUCxDQUFBLEVBQUM7SUFETDtJQUdBLElBQUMsQ0FBQSxPQUFELEdBQVc7RUFQ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QSxDQUFBO0lBQ0EsSUFBQSxDQUFLLE9BQUw7SUFDQSxRQUFBLENBQVMsSUFBQSxHQUFLLEdBQWQ7SUFDQSxPQUFBLEdBQWEsS0FBSCxHQUFjLFVBQWQsR0FBOEI7SUFDeEMsTUFBQSxHQUFhLEtBQUgsR0FBYyxVQUFkLEdBQThCO0FBRXhDO0FBQUE7SUFBQSxLQUFBLHFDQUFBOztNQUNDLElBQUEsQ0FBSyxPQUFPLENBQUMsQ0FBRCxDQUFaLEVBQWdCLElBQUEsR0FBSyxDQUFDLENBQUEsR0FBRSxDQUFILENBQXJCLEVBQTJCLElBQUEsR0FBSyxHQUFoQzttQkFDQSxJQUFBLENBQUssTUFBTSxDQUFDLENBQUQsQ0FBWCxFQUFlLElBQUEsR0FBSyxJQUFwQixFQUF5QixJQUFBLEdBQUssQ0FBQyxDQUFBLEdBQUUsQ0FBSCxDQUE5QjtJQUZELENBQUE7O0VBUlM7O0FBbEdKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnaHR0cHM6Ly9jZG4uc2t5cGFjay5kZXYvbG9kYXNoJ1xyXG5pbXBvcnQge2FzcyxsZXJwLHBhcmFtLHJhbmdlLGhleFRvQmFzZTY0LGVudGVyRnVsbHNjcmVlbn0gZnJvbSAnLi4vanMvdXRpbHMuanMnXHJcbmltcG9ydCB7U3F1YXJlfSBmcm9tICcuLi9qcy9zcXVhcmUuanMnXHJcbmltcG9ydCB7QnV0dG9ufSBmcm9tICcuLi9qcy9idXR0b24uanMnXHJcbmltcG9ydCB7Y29vcmRzLGdsb2JhbCx0b09iamVjdE5vdGF0aW9uLHRvVUNJfSBmcm9tICcuLi9qcy9nbG9iYWxzLmpzJ1xyXG5pbXBvcnQge2R1bXBTdGF0ZX0gZnJvbSAnLi4vanMvZ2xvYmFscy5qcydcclxuXHJcbmV4cG9ydCBjbGFzcyBCb2FyZFxyXG5cdGNvbnN0cnVjdG9yOiAoQG5yKSAtPlxyXG5cdFx0QHNxdWFyZXMgPSBbXVxyXG5cdFx0QGNsaWNrZWRTcXVhcmVzID0gW11cclxuXHRcdEBwaWVjZXMgPSBcIlwiXHJcblx0XHRmb3IgaSBpbiByYW5nZSA2NFxyXG5cdFx0XHRkbyAoaSkgPT4gQHNxdWFyZXMucHVzaCBuZXcgU3F1YXJlIEBuciwgaSwgPT4gQGNsaWNrIGlcclxuXHJcblx0XHRAYnV0dG9ucyA9IFtdXHJcblxyXG5cdGNsaWNrIDogKGkpID0+XHJcblx0XHRnID0gZ2xvYmFsXHJcblx0XHRpZiBAbnIgPT0gZy5jaGVzcy5oaXN0b3J5KCkubGVuZ3RoICUlIDIgdGhlbiByZXR1cm5cclxuXHRcdGNvbCA9IGkgJSUgOFxyXG5cdFx0cm93ID0gNyAtIGkgLy8gOFxyXG5cdFx0c3EgPSBnLmNoZXNzLmJvYXJkKClbcm93XVtjb2xdXHJcblx0XHRjb2xvciA9IFwid2JcIltnLmNoZXNzLmhpc3RvcnkoKS5sZW5ndGggJSUgMl0gIyBmw7ZydsOkbnRhZCBmw6RyZyBww6UgcGrDpHNlblxyXG5cdFx0Y3NsID0gQGNsaWNrZWRTcXVhcmVzLmxlbmd0aFxyXG5cdFx0aWYgY3NsID09IDBcclxuXHRcdFx0aWYgc3EgIT0gbnVsbCBhbmQgc3EuY29sb3IgPT0gY29sb3IgdGhlbiBAY2xpY2tlZFNxdWFyZXMucHVzaCBpXHJcblx0XHRlbHNlIGlmIGNzbCA9PSAxXHJcblx0XHRcdGlmIGkgPT0gQGNsaWNrZWRTcXVhcmVzWzBdICMgw6VuZ3JhIG9tIHNhbW1hIHJ1dGFcclxuXHRcdFx0XHRAY2xpY2tlZFNxdWFyZXMgPSBbXVxyXG5cdFx0XHRlbHNlICMga29udHJvbGxlcmEgZHJhZ2V0XHJcblx0XHRcdFx0QGNsaWNrZWRTcXVhcmVzLnB1c2ggaVxyXG5cdFx0XHRcdHVjaSA9IHRvVUNJIEBjbGlja2VkU3F1YXJlc1xyXG5cclxuXHRcdFx0XHQjIMOkciBkZXR0YSBldHQga29ycmVrdCBkcmFnPyBJIHPDpSBmYWxsLCB1dGbDtnIgZGV0XHJcblx0XHRcdFx0aWYgZy5jaGVzcy5tb3ZlIHtmcm9tOnVjaS5zbGljZSgwLDIpLCB0bzp1Y2kuc2xpY2UoMiw0KX1cclxuXHRcdFx0XHRcdEBjbGlja2VkU3F1YXJlcyA9IFtdXHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyBnLmNoZXNzXHJcblx0XHRcdFx0XHRpZiBnLmNoZXNzLmdhbWVfb3ZlcigpIHRoZW4gZy5wYXVzZWQgPSB0cnVlXHJcblx0XHRcdFx0XHRnLmNsb2Nrc1tnLmNoZXNzLmhpc3RvcnkoKS5sZW5ndGggJSUgMl0gKz0gZy5pbmNyZW1lbnRcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRAY2xpY2tlZFNxdWFyZXMucG9wKClcclxuXHJcblx0ZHJhdyA6ID0+XHJcblxyXG5cdFx0Zm9yIGJ1dHRvbiBpbiBAYnV0dG9uc1xyXG5cdFx0XHRidXR0b24uZHJhdygpXHJcblxyXG5cdFx0ZmlsbCAnd2hpdGUnXHJcblx0XHR0ZXh0U2l6ZSBnbG9iYWwuc2l6ZSgpICogMC4zXHJcblxyXG5cdFx0cHVzaCgpXHJcblx0XHRpZiBAbnI9PTAgdGhlbiB0cmFuc2xhdGUgZ2xvYmFsLm14KCksIGdsb2JhbC5teSgpXHJcblx0XHRlbHNlIHRyYW5zbGF0ZSBnbG9iYWwubXgoKSwgZ2xvYmFsLm15KCkgKyA5ICogZ2xvYmFsLnNpemUoKVxyXG5cclxuXHRcdGZvciBpIGluIHJhbmdlIDhcclxuXHRcdFx0Zm9yIGogaW4gcmFuZ2UgOFxyXG5cdFx0XHRcdHBpZWNlID0gZ2xvYmFsLmNoZXNzLmJvYXJkKClbNy1pXVtqXVxyXG5cdFx0XHRcdHNxID0gQHNxdWFyZXNbaSo4K2pdXHJcblx0XHRcdFx0aWYgQGNsaWNrZWRTcXVhcmVzLmxlbmd0aCBpbiBbMCwyXVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgZmFsc2VcclxuXHRcdFx0XHRpZiBAY2xpY2tlZFNxdWFyZXMubGVuZ3RoIGluIFsxXVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgaSo4K2o9PUBjbGlja2VkU3F1YXJlc1swXVxyXG5cdFx0XHRcdGVsc2UgaWYgQGNsaWNrZWRTcXVhcmVzLmxlbmd0aCBpbiBbMyw0XVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgaSo4K2o9PUBjbGlja2VkU3F1YXJlc1syXVxyXG5cclxuXHRcdHN0cm9rZSAnYmxhY2snXHJcblx0XHRpZiBnbG9iYWwucGF1c2VkIG9yIEBuciA9PSBnbG9iYWwuY2hlc3MuaGlzdG9yeSgpLmxlbmd0aCUyIHRoZW4gZmlsbCAxMjgsMTI4LDEyOCw2NCBlbHNlIG5vRmlsbCgpXHJcblx0XHRTSVpFID0gZ2xvYmFsLnNpemUoKVxyXG5cdFx0cmVjdCBTSVpFKjQsU0laRSo0LFNJWkUqOCxTSVpFKjhcclxuXHRcdHBvcCgpXHJcblx0XHRpZiBnbG9iYWwuY2xvY2tzWzBdIDw9IDAgb3IgZ2xvYmFsLmNsb2Nrc1sxXSA8PSAwIHRoZW4gZ2xvYmFsLnBhdXNlZCA9IHRydWVcclxuXHJcblx0XHRAZHJhd0Nsb2NrIDBcclxuXHRcdEBkcmF3Q2xvY2sgMVxyXG5cclxuXHRkcmF3Q2xvY2sgOiAocGxheWVyKSA9PlxyXG5cclxuXHRcdHAgPSBnbG9iYWwuY2hlc3MuaGlzdG9yeSgpLmxlbmd0aCAlJSAyXHJcblx0XHRmaWxsIFtcImJsYWNrXCIsXCJ3aGl0ZVwiXVtwbGF5ZXJdXHJcblx0XHRpZiBnbG9iYWwuY2xvY2tzW3BsYXllcl0gPCA2MCB0aGVuIGZpbGwgXCJyZWRcIlxyXG5cdFx0bm9TdHJva2UoKVxyXG5cdFx0dGV4dFNpemUgZ2xvYmFsLnNpemUoKVxyXG5cdFx0dCA9IGdsb2JhbC5jbG9ja3NbcGxheWVyXVxyXG5cdFx0aWYgbm90IGdsb2JhbC5wYXVzZWQgYW5kIHAhPXBsYXllclxyXG5cdFx0XHR0IC09IDEvMTIwXHJcblx0XHRnbG9iYWwuY2xvY2tzW3BsYXllcl0gPSB0XHJcblx0XHR0ID0gcm91bmQgdFxyXG5cdFx0c2VrdW5kZXIgPSB0ICUlIDYwXHJcblx0XHR0ID0gdCAvLyA2MFxyXG5cdFx0aWYgc2VrdW5kZXIgPCAxMCB0aGVuIHNla3VuZGVyID0gXCIwXCIgKyBzZWt1bmRlclxyXG5cdFx0bWludXRlciA9IHQgJSUgNjBcclxuXHRcdGlmIG1pbnV0ZXIgPCAxMCB0aGVuIG1pbnV0ZXIgPSBcIjBcIiArIG1pbnV0ZXJcclxuXHRcdHRpbW1hciA9IHQgLy8gNjBcclxuXHRcdGlmIHRpbW1hciA+IDAgdGhlbiByZXMgPSB0aW1tYXIgKyBcImhcIiArIG1pbnV0ZXJcclxuXHRcdGVsc2UgcmVzID0gbWludXRlciArIFwiOlwiICsgc2VrdW5kZXJcclxuXHRcdGlmIEBucj09MFxyXG5cdFx0XHRwdXNoKClcclxuXHRcdFx0dHJhbnNsYXRlIHdpZHRoLWdsb2JhbC5teCgpLzIsIGdsb2JhbC5zaXplKCkgKiBbMiw1XVtwbGF5ZXJdXHJcblx0XHRcdHNjYWxlIC0xLC0xXHJcblx0XHRcdHRleHQgcmVzLCAwLCAwXHJcblx0XHRcdHBvcCgpXHJcblx0XHRpZiBAbnI9PTFcclxuXHRcdFx0dGV4dCByZXMsIGdsb2JhbC5teCgpLzIsIGdsb2JhbC5zaXplKCkgKiBbMTMsMTZdW3BsYXllcl1cclxuXHJcblx0bGl0dGVyYSA6ID0+XHJcblx0XHRTSVpFID0gZ2xvYmFsLnNpemUoKVxyXG5cdFx0bm9TdHJva2UoKVxyXG5cdFx0ZmlsbCAnYmxhY2snXHJcblx0XHR0ZXh0U2l6ZSBTSVpFKjAuM1xyXG5cdFx0bGV0dGVycyA9IGlmIGZhbHNlIHRoZW4gXCJoZ2ZlZGNiYVwiIGVsc2UgXCJhYmNkZWZnaFwiXHJcblx0XHRkaWdpdHMgID0gaWYgZmFsc2UgdGhlbiBcIjEyMzQ1Njc4XCIgZWxzZSBcIjg3NjU0MzIxXCJcclxuXHJcblx0XHRmb3IgaSBpbiByYW5nZSA4XHJcblx0XHRcdHRleHQgbGV0dGVyc1tpXSxTSVpFKihpKzEpLFNJWkUqOC44XHJcblx0XHRcdHRleHQgZGlnaXRzW2ldLFNJWkUqMC4xNSxTSVpFKihpKzEpXHJcbiJdfQ==
//# sourceURL=c:\github\2023-026-chessx2\coffee\board.coffee