// Generated by CoffeeScript 2.5.1
var modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

import _ from 'https://cdn.skypack.dev/lodash';

import {
  ass,
  lerp,
  param,
  range,
  hexToBase64,
  enterFullscreen
} from '../js/utils.js';

import {
  Square
} from '../js/square.js';

import {
  Button,
  ClockButton
} from '../js/button.js';

import {
  coords,
  global,
  toObjectNotation,
  toUCI
} from '../js/globals.js';

import {
  dumpState
} from '../js/globals.js';

export var Board = class Board {
  constructor(nr) {
    var i, k, len, ref, x0, x1, y0, y1, y2;
    this.click = this.click.bind(this);
    this.draw = this.draw.bind(this);
    this.littera = this.littera.bind(this);
    this.resize = this.resize.bind(this);
    this.nr = nr;
    this.squares = [];
    this.clickedSquares = [];
    this.pieces = "";
    ref = range(64);
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      ((i) => {
        return this.squares.push(new Square(this.nr, i, () => {
          return this.click(i);
        }));
      })(i);
    }
    this.buttons = [];
    x0 = round(global.mx() / 2);
    x1 = width - x0;
    y0 = round(0.20 * height);
    y1 = round(0.50 * height);
    y2 = round(0.80 * height);
    this.buttons.push(new ClockButton(x0, y1, this.nr, () => {
      return global.paused = !global.paused;
    }));
    this.buttons.push(new ClockButton(x1, y1, this.nr, () => {
      return global.paused = !global.paused;
    }));
  }

  calcMaterial() {
    var hash, k, len, piece, pieces, res;
    res = 0;
    hash = {
      '.': 0,
      'k': 0,
      'r': -5,
      'q': -9,
      'b': -3,
      'n': -3,
      'p': -1,
      'K': 0,
      'R': 5,
      'Q': 9,
      'B': 3,
      'N': 3,
      'P': 1,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '/': 0
    };
    pieces = global.chess.fen().split(' ')[0];
    console.log(pieces);
    for (k = 0, len = pieces.length; k < len; k++) {
      piece = pieces[k];
      res += hash[piece];
    }
    console.log(res);
    return res;
  }

  click(i) {
    var col, color, csl, g, row, sq, uci;
    g = global;
    if (g.paused) {
      return;
    }
    if (this.nr === modulo(g.chess.history().length, 2)) {
      return;
    }
    col = modulo(i, 8);
    row = 7 - Math.floor(i / 8);
    sq = g.chess.board()[row][col];
    color = "wb"[modulo(g.chess.history().length, 2)];
    csl = this.clickedSquares.length;
    if (csl === 0) {
      if (sq !== null && sq.color === color) {
        return this.clickedSquares.push(i);
      }
    } else if (csl === 1) {
      if (i === this.clickedSquares[0]) {
        return this.clickedSquares = []; // kontrollera draget
      } else {
        this.clickedSquares.push(i);
        uci = toUCI(this.clickedSquares);
        // är detta ett korrekt drag? I så fall, utför det
        if (g.chess.move({
          from: uci.slice(0, 2),
          to: uci.slice(2, 4),
          promotion: 'q'
        })) {
          this.clickedSquares = [];
          console.log(g.chess);
          global.audio.play();
          g.paused = false;
          if (g.chess.game_over()) {
            g.paused = true;
          }
          g.clocks[modulo(g.chess.history().length, 2)] += g.increment;
          return global.material = this.calcMaterial();
        } else {
          return this.clickedSquares.pop();
        }
      }
    }
  }

  draw() {
    var SIZE, button, i, j, k, l, len, len1, len2, m, piece, ref, ref1, ref2, ref3, ref4, ref5, sq;
    ref = this.buttons;
    for (k = 0, len = ref.length; k < len; k++) {
      button = ref[k];
      button.draw();
    }
    fill('white');
    textSize(global.size() * 0.3);
    push();
    if (this.nr === 0) {
      translate(global.mx(), global.my());
    } else {
      translate(global.mx(), global.my() + 9 * global.size());
    }
    ref1 = range(8);
    for (l = 0, len1 = ref1.length; l < len1; l++) {
      i = ref1[l];
      ref2 = range(8);
      for (m = 0, len2 = ref2.length; m < len2; m++) {
        j = ref2[m];
        piece = global.chess.board()[7 - i][j];
        sq = this.squares[i * 8 + j];
        if ((ref3 = this.clickedSquares.length) === 0 || ref3 === 2) {
          sq.draw(piece, false);
        }
        if ((ref4 = this.clickedSquares.length) === 1) {
          sq.draw(piece, i * 8 + j === this.clickedSquares[0]);
        } else if ((ref5 = this.clickedSquares.length) === 3 || ref5 === 4) {
          sq.draw(piece, i * 8 + j === this.clickedSquares[2]);
        }
      }
    }
    stroke('black');
    if (global.paused || this.nr === global.chess.history().length % 2) {
      fill(128, 128, 128, 64);
    } else {
      noFill();
    }
    SIZE = global.size();
    rect(SIZE * 4, SIZE * 4, SIZE * 8, SIZE * 8);
    pop();
    if (global.clocks[0] <= 0 || global.clocks[1] <= 0) {
      return global.paused = true;
    }
  }

  littera() {
    var SIZE, digits, i, k, len, letters, ref, results;
    SIZE = global.size();
    noStroke();
    fill('black');
    textSize(SIZE * 0.3);
    letters = false ? "hgfedcba" : "abcdefgh";
    digits = false ? "12345678" : "87654321";
    ref = range(8);
    results = [];
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      text(letters[i], SIZE * (i + 1), SIZE * 8.8);
      results.push(text(digits[i], SIZE * 0.15, SIZE * (i + 1)));
    }
    return results;
  }

  resize() {
    var button, k, len, ref, results;
    ref = this.buttons;
    results = [];
    for (k = 0, len = ref.length; k < len; k++) {
      button = ref[k];
      results.push(button.resize());
    }
    return results;
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9hcmQuanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcYm9hcmQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBOztBQUFBLE9BQU8sQ0FBUCxNQUFBOztBQUNBLE9BQUE7RUFBUSxHQUFSO0VBQVksSUFBWjtFQUFpQixLQUFqQjtFQUF1QixLQUF2QjtFQUE2QixXQUE3QjtFQUF5QyxlQUF6QztDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLE1BQVI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxNQUFSO0VBQWUsV0FBZjtDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLE1BQVI7RUFBZSxNQUFmO0VBQXNCLGdCQUF0QjtFQUF1QyxLQUF2QztDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLFNBQVI7Q0FBQSxNQUFBOztBQUVBLE9BQUEsSUFBYSxRQUFOLE1BQUEsTUFBQTtFQUNOLFdBQWEsR0FBQSxDQUFBO0FBQ2QsUUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBO1FBMEJDLENBQUEsWUFBQSxDQUFBO1FBOEJBLENBQUEsV0FBQSxDQUFBO1FBNkJBLENBQUEsY0FBQSxDQUFBO1FBWUEsQ0FBQSxhQUFBLENBQUE7SUFsR2MsSUFBQyxDQUFBO0lBQ2QsSUFBQyxDQUFBLE9BQUQsR0FBVztJQUNYLElBQUMsQ0FBQSxjQUFELEdBQWtCO0lBQ2xCLElBQUMsQ0FBQSxNQUFELEdBQVU7QUFDVjtJQUFBLEtBQUEscUNBQUE7O01BQ0ksQ0FBQSxDQUFDLENBQUQsQ0FBQSxHQUFBO2VBQU8sSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQWMsSUFBSSxNQUFKLENBQVcsSUFBQyxDQUFBLEVBQVosRUFBZ0IsQ0FBaEIsRUFBbUIsQ0FBQSxDQUFBLEdBQUE7aUJBQUcsSUFBQyxDQUFBLEtBQUQsQ0FBTyxDQUFQO1FBQUgs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LENBQXBCLElBQXlCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBRCxDQUFiLElBQW9CLENBQWhEO2FBQXVELE1BQU0sQ0FBQyxNQUFQLEdBQWdCLEtBQXZFOztFQTNCTTs7RUE2QlAsT0FBVSxDQUFBLENBQUE7QUFDWCxRQUFBLElBQUEsRUFBQSxNQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLEdBQUEsRUFBQTtJQUFFLElBQUEsR0FBTyxNQUFNLENBQUMsSUFBUCxDQUFBO0lBQ1AsUUFBQSxDQUFBO0lBQ0EsSUFBQSxDQUFLLE9BQUw7SUFDQSxRQUFBLENBQVMsSUFBQSxHQUFLLEdBQWQ7SUFDQSxPQUFBLEdBQWEsS0FBSCxHQUFjLFVBQWQsR0FBOEI7SUFDeEMsTUFBQSxHQUFhLEtBQUgsR0FBYyxVQUFkLEdBQThCO0FBRXhDO0FBQUE7SUFBQSxLQUFBLHFDQUFBOztNQUNDLElBQUEsQ0FBSyxPQUFPLENBQUMsQ0FBRCxDQUFaLEVBQWdCLElBQUEsR0FBSyxDQUFDLENBQUEsR0FBRSxDQUFILENBQXJCLEVBQTJCLElBQUEsR0FBSyxHQUFoQzttQkFDQSxJQUFBLENBQUssTUFBTSxDQUFDLENBQUQsQ0FBWCxFQUFlLElBQUEsR0FBSyxJQUFwQixFQUF5QixJQUFBLEdBQUssQ0FBQyxDQUFBLEdBQUUsQ0FBSCxDQUE5QjtJQUZELENBQUE7O0VBUlM7O0VBWVYsTUFBUSxDQUFBLENBQUE7QUFDVCxRQUFBLE1BQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQTtBQUFFO0FBQUE7SUFBQSxLQUFBLHFDQUFBOzttQkFDQyxNQUFNLENBQUMsTUFBUCxDQUFBO0lBREQsQ0FBQTs7RUFETzs7QUFuR0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdodHRwczovL2Nkbi5za3lwYWNrLmRldi9sb2Rhc2gnXHJcbmltcG9ydCB7YXNzLGxlcnAscGFyYW0scmFuZ2UsaGV4VG9CYXNlNjQsZW50ZXJGdWxsc2NyZWVufSBmcm9tICcuLi9qcy91dGlscy5qcydcclxuaW1wb3J0IHtTcXVhcmV9IGZyb20gJy4uL2pzL3NxdWFyZS5qcydcclxuaW1wb3J0IHtCdXR0b24sQ2xvY2tCdXR0b259IGZyb20gJy4uL2pzL2J1dHRvbi5qcydcclxuaW1wb3J0IHtjb29yZHMsZ2xvYmFsLHRvT2JqZWN0Tm90YXRpb24sdG9VQ0l9IGZyb20gJy4uL2pzL2dsb2JhbHMuanMnXHJcbmltcG9ydCB7ZHVtcFN0YXRlfSBmcm9tICcuLi9qcy9nbG9iYWxzLmpzJ1xyXG5cclxuZXhwb3J0IGNsYXNzIEJvYXJkXHJcblx0Y29uc3RydWN0b3I6IChAbnIpIC0+XHJcblx0XHRAc3F1YXJlcyA9IFtdXHJcblx0XHRAY2xpY2tlZFNxdWFyZXMgPSBbXVxyXG5cdFx0QHBpZWNlcyA9IFwiXCJcclxuXHRcdGZvciBpIGluIHJhbmdlIDY0XHJcblx0XHRcdGRvIChpKSA9PiBAc3F1YXJlcy5wdXNoIG5ldyBTcXVhcmUgQG5yLCBpLCA9PiBAY2xpY2sgaVxyXG5cclxuXHRcdEBidXR0b25zID0gW11cclxuXHJcblx0XHR4MCA9IHJvdW5kIGdsb2JhbC5teCgpLzJcclxuXHRcdHgxID0gd2lkdGgtIHgwXHJcblx0XHR5MCA9IHJvdW5kIDAuMjAqaGVpZ2h0XHJcblx0XHR5MSA9IHJvdW5kIDAuNTAqaGVpZ2h0XHJcblx0XHR5MiA9IHJvdW5kIDAuODAqaGVpZ2h0XHJcblxyXG5cdFx0QGJ1dHRvbnMucHVzaCBuZXcgQ2xvY2tCdXR0b24geDAseTEsQG5yLD0+IGdsb2JhbC5wYXVzZWQgPSBub3QgZ2xvYmFsLnBhdXNlZFxyXG5cdFx0QGJ1dHRvbnMucHVzaCBuZXcgQ2xvY2tCdXR0b24geDEseTEsQG5yLD0+IGdsb2JhbC5wYXVzZWQgPSBub3QgZ2xvYmFsLnBhdXNlZFxyXG5cclxuXHRjYWxjTWF0ZXJpYWwgOiAoKSAtPlxyXG5cdFx0cmVzID0gMFxyXG5cdFx0aGFzaCA9IHsnLic6MCwnayc6MCwncic6LTUsJ3EnOi05LCdiJzotMywnbic6LTMsJ3AnOi0xLCdLJzowLCdSJzo1LCdRJzo5LCdCJzozLCdOJzozLCdQJzoxLCAnMSc6MCwnMic6MCwnMyc6MCwnNCc6MCwnNSc6MCwnNic6MCwnNyc6MCwnOCc6MCwnOSc6MCwnLyc6MH1cdFx0XHJcblx0XHRwaWVjZXMgPSBnbG9iYWwuY2hlc3MuZmVuKCkuc3BsaXQoJyAnKVswXVxyXG5cdFx0Y29uc29sZS5sb2cgcGllY2VzXHJcblx0XHRyZXMgKz0gaGFzaFtwaWVjZV0gZm9yIHBpZWNlIGluIHBpZWNlc1xyXG5cdFx0Y29uc29sZS5sb2cgcmVzXHJcblx0XHRyZXR1cm4gcmVzXHJcblxyXG5cdGNsaWNrIDogKGkpID0+XHJcblx0XHRnID0gZ2xvYmFsXHJcblx0XHRpZiBnLnBhdXNlZCB0aGVuIHJldHVyblxyXG5cdFx0aWYgQG5yID09IGcuY2hlc3MuaGlzdG9yeSgpLmxlbmd0aCAlJSAyIHRoZW4gcmV0dXJuXHJcblx0XHRjb2wgPSBpICUlIDhcclxuXHRcdHJvdyA9IDcgLSBpIC8vIDhcclxuXHRcdHNxID0gZy5jaGVzcy5ib2FyZCgpW3Jvd11bY29sXVxyXG5cdFx0Y29sb3IgPSBcIndiXCJbZy5jaGVzcy5oaXN0b3J5KCkubGVuZ3RoICUlIDJdICMgZsO2cnbDpG50YWQgZsOkcmcgcMOlIHBqw6RzZW5cclxuXHRcdGNzbCA9IEBjbGlja2VkU3F1YXJlcy5sZW5ndGhcclxuXHRcdGlmIGNzbCA9PSAwXHJcblx0XHRcdGlmIHNxICE9IG51bGwgYW5kIHNxLmNvbG9yID09IGNvbG9yIHRoZW4gQGNsaWNrZWRTcXVhcmVzLnB1c2ggaVxyXG5cdFx0ZWxzZSBpZiBjc2wgPT0gMVxyXG5cdFx0XHRpZiBpID09IEBjbGlja2VkU3F1YXJlc1swXSAjIMOlbmdyYSBvbSBzYW1tYSBydXRhXHJcblx0XHRcdFx0QGNsaWNrZWRTcXVhcmVzID0gW11cclxuXHRcdFx0ZWxzZSAjIGtvbnRyb2xsZXJhIGRyYWdldFxyXG5cdFx0XHRcdEBjbGlja2VkU3F1YXJlcy5wdXNoIGlcclxuXHRcdFx0XHR1Y2kgPSB0b1VDSSBAY2xpY2tlZFNxdWFyZXNcclxuXHJcblx0XHRcdFx0IyDDpHIgZGV0dGEgZXR0IGtvcnJla3QgZHJhZz8gSSBzw6UgZmFsbCwgdXRmw7ZyIGRldFxyXG5cdFx0XHRcdGlmIGcuY2hlc3MubW92ZSB7ZnJvbTp1Y2kuc2xpY2UoMCwyKSwgdG86dWNpLnNsaWNlKDIsNCksIHByb21vdGlvbjoncSd9XHJcblx0XHRcdFx0XHRAY2xpY2tlZFNxdWFyZXMgPSBbXVxyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2cgZy5jaGVzc1xyXG5cdFx0XHRcdFx0Z2xvYmFsLmF1ZGlvLnBsYXkoKVxyXG5cdFx0XHRcdFx0Zy5wYXVzZWQgPSBmYWxzZVxyXG5cdFx0XHRcdFx0aWYgZy5jaGVzcy5nYW1lX292ZXIoKSB0aGVuIGcucGF1c2VkID0gdHJ1ZVxyXG5cdFx0XHRcdFx0Zy5jbG9ja3NbZy5jaGVzcy5oaXN0b3J5KCkubGVuZ3RoICUlIDJdICs9IGcuaW5jcmVtZW50XHJcblx0XHRcdFx0XHRnbG9iYWwubWF0ZXJpYWwgPSBAY2FsY01hdGVyaWFsKClcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRAY2xpY2tlZFNxdWFyZXMucG9wKClcclxuXHJcblx0ZHJhdyA6ID0+XHJcblx0XHRmb3IgYnV0dG9uIGluIEBidXR0b25zXHJcblx0XHRcdGJ1dHRvbi5kcmF3KClcclxuXHJcblx0XHRmaWxsICd3aGl0ZSdcclxuXHRcdHRleHRTaXplIGdsb2JhbC5zaXplKCkgKiAwLjNcclxuXHJcblx0XHRwdXNoKClcclxuXHRcdGlmIEBucj09MCB0aGVuIHRyYW5zbGF0ZSBnbG9iYWwubXgoKSwgZ2xvYmFsLm15KClcclxuXHRcdGVsc2UgdHJhbnNsYXRlIGdsb2JhbC5teCgpLCBnbG9iYWwubXkoKSArIDkgKiBnbG9iYWwuc2l6ZSgpXHJcblxyXG5cdFx0Zm9yIGkgaW4gcmFuZ2UgOFxyXG5cdFx0XHRmb3IgaiBpbiByYW5nZSA4XHJcblx0XHRcdFx0cGllY2UgPSBnbG9iYWwuY2hlc3MuYm9hcmQoKVs3LWldW2pdXHJcblx0XHRcdFx0c3EgPSBAc3F1YXJlc1tpKjgral1cclxuXHRcdFx0XHRpZiBAY2xpY2tlZFNxdWFyZXMubGVuZ3RoIGluIFswLDJdXHJcblx0XHRcdFx0XHRzcS5kcmF3IHBpZWNlLCBmYWxzZVxyXG5cdFx0XHRcdGlmIEBjbGlja2VkU3F1YXJlcy5sZW5ndGggaW4gWzFdXHJcblx0XHRcdFx0XHRzcS5kcmF3IHBpZWNlLCBpKjgraj09QGNsaWNrZWRTcXVhcmVzWzBdXHJcblx0XHRcdFx0ZWxzZSBpZiBAY2xpY2tlZFNxdWFyZXMubGVuZ3RoIGluIFszLDRdXHJcblx0XHRcdFx0XHRzcS5kcmF3IHBpZWNlLCBpKjgraj09QGNsaWNrZWRTcXVhcmVzWzJdXHJcblxyXG5cdFx0c3Ryb2tlICdibGFjaydcclxuXHRcdGlmIGdsb2JhbC5wYXVzZWQgb3IgQG5yID09IGdsb2JhbC5jaGVzcy5oaXN0b3J5KCkubGVuZ3RoJTIgdGhlbiBmaWxsIDEyOCwxMjgsMTI4LDY0IGVsc2Ugbm9GaWxsKClcclxuXHRcdFNJWkUgPSBnbG9iYWwuc2l6ZSgpXHJcblx0XHRyZWN0IFNJWkUqNCxTSVpFKjQsU0laRSo4LFNJWkUqOFxyXG5cdFx0cG9wKClcclxuXHRcdGlmIGdsb2JhbC5jbG9ja3NbMF0gPD0gMCBvciBnbG9iYWwuY2xvY2tzWzFdIDw9IDAgdGhlbiBnbG9iYWwucGF1c2VkID0gdHJ1ZVxyXG5cclxuXHRsaXR0ZXJhIDogPT5cclxuXHRcdFNJWkUgPSBnbG9iYWwuc2l6ZSgpXHJcblx0XHRub1N0cm9rZSgpXHJcblx0XHRmaWxsICdibGFjaydcclxuXHRcdHRleHRTaXplIFNJWkUqMC4zXHJcblx0XHRsZXR0ZXJzID0gaWYgZmFsc2UgdGhlbiBcImhnZmVkY2JhXCIgZWxzZSBcImFiY2RlZmdoXCJcclxuXHRcdGRpZ2l0cyAgPSBpZiBmYWxzZSB0aGVuIFwiMTIzNDU2NzhcIiBlbHNlIFwiODc2NTQzMjFcIlxyXG5cclxuXHRcdGZvciBpIGluIHJhbmdlIDhcclxuXHRcdFx0dGV4dCBsZXR0ZXJzW2ldLFNJWkUqKGkrMSksU0laRSo4LjhcclxuXHRcdFx0dGV4dCBkaWdpdHNbaV0sU0laRSowLjE1LFNJWkUqKGkrMSlcclxuXHJcblx0cmVzaXplOiA9PlxyXG5cdFx0Zm9yIGJ1dHRvbiBpbiBAYnV0dG9uc1xyXG5cdFx0XHRidXR0b24ucmVzaXplKClcclxuIl19
//# sourceURL=c:\github\2023-026-chessx2\coffee\board.coffee