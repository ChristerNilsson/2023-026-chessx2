// Generated by CoffeeScript 2.5.1
var copyToClipboard, iosCopyToClipboard,
  modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

import _ from 'https://cdn.skypack.dev/lodash';

import {
  ass,
  lerp,
  param,
  range,
  hexToBase64,
  enterFullscreen
} from '../js/utils.js';

import {
  Square
} from '../js/square.js';

import {
  Button
} from '../js/button.js';

import {
  coords,
  global,
  toObjectNotation,
  toUCI
} from '../js/globals.js';

import {
  dumpState
} from '../js/globals.js';

copyToClipboard = (string) => {
  var copyHotkey, err, isMac, result, sel, textarea, xrange;
  textarea = null;
  result = null;
  try {
    textarea = document.createElement('textarea');
    textarea.setAttribute('readonly', true);
    textarea.setAttribute('contenteditable', true);
    textarea.style.position = 'fixed';
    textarea.value = string;
    document.body.appendChild(textarea);
    textarea.focus();
    textarea.select();
    xrange = document.createRange();
    xrange.selectNodeContents(textarea);
    sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(xrange);
    textarea.setSelectionRange(0, textarea.value.length);
    result = document.execCommand('copy');
  } catch (error) {
    err = error;
    alert(err);
    result = null;
  } finally {
    document.body.removeChild(textarea);
  }
  if (!result) {
    isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    copyHotkey = isMac != null ? isMac : {
      '⌘C': 'CTRL+C'
    };
    result = prompt(`Press ${copyHotkey}`, string);
    if (!result) {
      return false;
    }
  }
  return true;
};

iosCopyToClipboard = (el) => {
  var oldContentEditable, oldReadOnly, s, xrange;
  oldContentEditable = el.contentEditable;
  oldReadOnly = el.readOnly;
  xrange = document.createRange();
  el.contentEditable = true;
  el.readOnly = false;
  xrange.selectNodeContents(el);
  s = window.getSelection();
  s.removeAllRanges();
  s.addRange(xrange);
  el.setSelectionRange(0, 999999);
  el.contentEditable = oldContentEditable;
  el.readOnly = oldReadOnly;
  return document.execCommand('copy');
};

export var Board = class Board {
  constructor(nr) {
    var i, k, len, ref;
    this.click = this.click.bind(this);
    this.draw = this.draw.bind(this);
    this.littera = this.littera.bind(this);
    this.nr = nr;
    this.squares = [];
    this.clickedSquares = [];
    this.pieces = "";
    ref = range(64);
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      ((i) => {
        return this.squares.push(new Square(this.nr, i, () => {
          return this.click(i);
        }));
      })(i);
    }
    this.buttons = [];
  }

  click(i) {
    var col, color, csl, g, row, sq, uci;
    g = global;
    if (this.nr === modulo(g.chess.history().length, 2)) {
      return;
    }
    col = modulo(i, 8);
    row = 7 - Math.floor(i / 8);
    sq = g.chess.board()[row][col];
    color = "wb"[modulo(g.chess.history().length, 2)];
    csl = this.clickedSquares.length;
    if (csl === 0) {
      if (sq !== null && sq.color === color) {
        return this.clickedSquares.push(i);
      }
    } else if (csl === 1) {
      if (i === this.clickedSquares[0]) {
        return this.clickedSquares = []; // kontrollera draget
      } else {
        this.clickedSquares.push(i);
        uci = toUCI(this.clickedSquares);
        // är detta ett korrekt drag? I så fall, utför det
        if (g.chess.move({
          from: uci.slice(0, 2),
          to: uci.slice(2, 4)
        })) {
          //input = document.getElementById "myInput"
          //input.value = g.chess.pgn()
          //copyToClipboard g.chess.pgn()
          //navigator.clipboard.writeText g.chess.pgn()
          //input = document.getElementById "myInput"

          // copyText = document.querySelector "#myInput"
          g.pgn = JSON.stringify(g.chess.pgn());
          return this.clickedSquares = [];
        } else {
          return this.clickedSquares.pop();
        }
      }
    }
  }

  draw() {
    var SIZE, button, i, j, k, l, len, len1, len2, m, piece, ref, ref1, ref2, ref3, ref4, ref5, sq;
    ref = this.buttons;
    for (k = 0, len = ref.length; k < len; k++) {
      button = ref[k];
      button.draw();
    }
    fill('white');
    textSize(global.size() * 0.3);
    push();
    if (this.nr === 0) {
      translate(global.mx(), global.my());
    } else {
      translate(global.mx(), global.my() + 9 * global.size());
    }
    ref1 = range(8);
    for (l = 0, len1 = ref1.length; l < len1; l++) {
      i = ref1[l];
      ref2 = range(8);
      for (m = 0, len2 = ref2.length; m < len2; m++) {
        j = ref2[m];
        piece = global.chess.board()[7 - i][j];
        sq = this.squares[i * 8 + j];
        if ((ref3 = this.clickedSquares.length) === 0 || ref3 === 2) {
          sq.draw(piece, false);
        }
        if ((ref4 = this.clickedSquares.length) === 1) {
          sq.draw(piece, i * 8 + j === this.clickedSquares[0]);
        } else if ((ref5 = this.clickedSquares.length) === 3 || ref5 === 4) {
          sq.draw(piece, i * 8 + j === this.clickedSquares[2]);
        }
      }
    }
    stroke('black');
    if (this.nr === global.chess.history().length % 2) {
      fill(128, 128, 128, 64);
    } else {
      noFill();
    }
    SIZE = global.size();
    rect(SIZE * 4, SIZE * 4, SIZE * 8, SIZE * 8);
    return pop();
  }

  littera() {
    var SIZE, digits, i, k, len, letters, ref, results;
    SIZE = global.size();
    noStroke();
    fill('black');
    textSize(SIZE * 0.3);
    letters = false ? "hgfedcba" : "abcdefgh";
    digits = false ? "12345678" : "87654321";
    ref = range(8);
    results = [];
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      text(letters[i], SIZE * (i + 1), SIZE * 8.8);
      results.push(text(digits[i], SIZE * 0.15, SIZE * (i + 1)));
    }
    return results;
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9hcmQuanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZVxcYm9hcmQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLGVBQUEsRUFBQSxrQkFBQTtFQUFBOztBQUFBLE9BQU8sQ0FBUCxNQUFBOztBQUNBLE9BQUE7RUFBUSxHQUFSO0VBQVksSUFBWjtFQUFpQixLQUFqQjtFQUF1QixLQUF2QjtFQUE2QixXQUE3QjtFQUF5QyxlQUF6QztDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLE1BQVI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxNQUFSO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsTUFBUjtFQUFlLE1BQWY7RUFBc0IsZ0JBQXRCO0VBQXVDLEtBQXZDO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsU0FBUjtDQUFBLE1BQUE7O0FBRUEsZUFBQSxHQUFrQixDQUFDLE1BQUQsQ0FBQSxHQUFBO0FBQ2xCLE1BQUEsVUFBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsRUFBQSxRQUFBLEVBQUE7RUFBQyxRQUFBLEdBQVc7RUFDWCxNQUFBLEdBQVM7QUFFVDtJQUNDLFFBQUEsR0FBVyxRQUFRLENBQUMsYUFBVCxDQUF1QixVQUF2QjtJQUNYLFFBQVEsQ0FBQyxZQUFULENBQXNCLFVBQXRCLEVBQWtDLElBQWxDO0lBQ0EsUUFBUSxDQUFDLFlBQVQsQ0FBc0IsaUJBQXRCLEVBQXlDLElBQXpDO0lBQ0EsUUFBUSxDQUFDLEtBQUssQ0FBQyxRQUFmLEdBQTBCO0lBQzFCLFFBQVEsQ0FBQyxLQUFULEdBQWlCO0lBRWpCLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBZCxDQUEwQixRQUExQjtJQUVBLFFBQVEsQ0FBQyxLQUFULENBQUE7SUFDQSxRQUFRLENBQUMsTUFBVCxDQUFBO0lBRUEsTUFBQSxHQUFTLFFBQVEsQ0FBQyxXQUFULENBQUE7SUFDVCxNQUFNLENBQUMsa0JBQVAsQ0FBMEIs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QUFBLEdBQWEsS0FBSCxHQUFjLFVBQWQsR0FBOEI7QUFFeEM7QUFBQTtJQUFBLEtBQUEscUNBQUE7O01BQ0MsSUFBQSxDQUFLLE9BQU8sQ0FBQyxDQUFELENBQVosRUFBZ0IsSUFBQSxHQUFLLENBQUMsQ0FBQSxHQUFFLENBQUgsQ0FBckIsRUFBMkIsSUFBQSxHQUFLLEdBQWhDO21CQUNBLElBQUEsQ0FBSyxNQUFNLENBQUMsQ0FBRCxDQUFYLEVBQWUsSUFBQSxHQUFLLElBQXBCLEVBQXlCLElBQUEsR0FBSyxDQUFDLENBQUEsR0FBRSxDQUFILENBQTlCO0lBRkQsQ0FBQTs7RUFSUzs7QUF0RUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdodHRwczovL2Nkbi5za3lwYWNrLmRldi9sb2Rhc2gnXHJcbmltcG9ydCB7YXNzLGxlcnAscGFyYW0scmFuZ2UsaGV4VG9CYXNlNjQsZW50ZXJGdWxsc2NyZWVufSBmcm9tICcuLi9qcy91dGlscy5qcydcclxuaW1wb3J0IHtTcXVhcmV9IGZyb20gJy4uL2pzL3NxdWFyZS5qcydcclxuaW1wb3J0IHtCdXR0b259IGZyb20gJy4uL2pzL2J1dHRvbi5qcydcclxuaW1wb3J0IHtjb29yZHMsZ2xvYmFsLHRvT2JqZWN0Tm90YXRpb24sdG9VQ0l9IGZyb20gJy4uL2pzL2dsb2JhbHMuanMnXHJcbmltcG9ydCB7ZHVtcFN0YXRlfSBmcm9tICcuLi9qcy9nbG9iYWxzLmpzJ1xyXG5cclxuY29weVRvQ2xpcGJvYXJkID0gKHN0cmluZykgPT5cclxuXHR0ZXh0YXJlYSA9IG51bGxcclxuXHRyZXN1bHQgPSBudWxsXHJcblxyXG5cdHRyeSBcclxuXHRcdHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcclxuXHRcdHRleHRhcmVhLnNldEF0dHJpYnV0ZSgncmVhZG9ubHknLCB0cnVlKTtcclxuXHRcdHRleHRhcmVhLnNldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJywgdHJ1ZSk7XHJcblx0XHR0ZXh0YXJlYS5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7ICMgcHJldmVudCBzY3JvbGwgZnJvbSBqdW1waW5nIHRvIHRoZSBib3R0b20gd2hlbiBmb2N1cyBpcyBzZXQuXHJcblx0XHR0ZXh0YXJlYS52YWx1ZSA9IHN0cmluZ1xyXG5cclxuXHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQgdGV4dGFyZWFcclxuXHJcblx0XHR0ZXh0YXJlYS5mb2N1cygpXHJcblx0XHR0ZXh0YXJlYS5zZWxlY3QoKVxyXG5cclxuXHRcdHhyYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKClcclxuXHRcdHhyYW5nZS5zZWxlY3ROb2RlQ29udGVudHModGV4dGFyZWEpXHJcblxyXG5cdFx0c2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpXHJcblx0XHRzZWwucmVtb3ZlQWxsUmFuZ2VzKClcclxuXHRcdHNlbC5hZGRSYW5nZSB4cmFuZ2VcclxuXHJcblx0XHR0ZXh0YXJlYS5zZXRTZWxlY3Rpb25SYW5nZSAwLCB0ZXh0YXJlYS52YWx1ZS5sZW5ndGhcclxuXHRcdHJlc3VsdCA9IGRvY3VtZW50LmV4ZWNDb21tYW5kICdjb3B5J1xyXG5cdGNhdGNoIGVyclxyXG5cdFx0YWxlcnQgZXJyXHJcblx0XHRyZXN1bHQgPSBudWxsXHJcblx0ZmluYWxseVxyXG5cdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCB0ZXh0YXJlYVxyXG5cdFxyXG5cclxuXHQjbWFudWFsIGNvcHkgZmFsbGJhY2sgdXNpbmcgcHJvbXB0XHJcblx0aWYgIXJlc3VsdCBcclxuXHRcdGlzTWFjID0gbmF2aWdhdG9yLnBsYXRmb3JtLnRvVXBwZXJDYXNlKCkuaW5kZXhPZignTUFDJykgPj0gMFxyXG5cdFx0Y29weUhvdGtleSA9IGlzTWFjID8gJ+KMmEMnIDogJ0NUUkwrQyc7XHJcblx0XHRyZXN1bHQgPSBwcm9tcHQoXCJQcmVzcyAje2NvcHlIb3RrZXl9XCIsIHN0cmluZyk7ICMgZXNsaW50LWRpc2FibGUtbGluZSBuby1hbGVydFxyXG5cdFx0aWYgKCFyZXN1bHQpIFxyXG5cdFx0XHRyZXR1cm4gZmFsc2VcclxuXHRyZXR1cm4gdHJ1ZVxyXG5cclxuXHJcbmlvc0NvcHlUb0NsaXBib2FyZCA9IChlbCkgPT5cclxuXHRvbGRDb250ZW50RWRpdGFibGUgPSBlbC5jb250ZW50RWRpdGFibGVcclxuXHRvbGRSZWFkT25seSA9IGVsLnJlYWRPbmx5XHJcblx0eHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKVxyXG5cclxuXHRlbC5jb250ZW50RWRpdGFibGUgPSB0cnVlXHJcblx0ZWwucmVhZE9ubHkgPSBmYWxzZVxyXG5cdHhyYW5nZS5zZWxlY3ROb2RlQ29udGVudHMgZWxcclxuXHJcblx0cyA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKVxyXG5cdHMucmVtb3ZlQWxsUmFuZ2VzKClcclxuXHRzLmFkZFJhbmdlIHhyYW5nZVxyXG5cclxuXHRlbC5zZXRTZWxlY3Rpb25SYW5nZSAwLCA5OTk5OTkgXHJcblxyXG5cdGVsLmNvbnRlbnRFZGl0YWJsZSA9IG9sZENvbnRlbnRFZGl0YWJsZVxyXG5cdGVsLnJlYWRPbmx5ID0gb2xkUmVhZE9ubHlcclxuXHJcblx0ZG9jdW1lbnQuZXhlY0NvbW1hbmQgJ2NvcHknXHJcblxyXG5leHBvcnQgY2xhc3MgQm9hcmRcclxuXHRjb25zdHJ1Y3RvcjogKEBucikgLT5cclxuXHRcdEBzcXVhcmVzID0gW11cclxuXHRcdEBjbGlja2VkU3F1YXJlcyA9IFtdXHJcblx0XHRAcGllY2VzID0gXCJcIlxyXG5cdFx0Zm9yIGkgaW4gcmFuZ2UgNjRcclxuXHRcdFx0ZG8gKGkpID0+IEBzcXVhcmVzLnB1c2ggbmV3IFNxdWFyZSBAbnIsIGksID0+IEBjbGljayBpXHJcblxyXG5cdFx0QGJ1dHRvbnMgPSBbXVxyXG5cclxuXHRjbGljayA6IChpKSA9PlxyXG5cdFx0ZyA9IGdsb2JhbFxyXG5cdFx0aWYgQG5yID09IGcuY2hlc3MuaGlzdG9yeSgpLmxlbmd0aCAlJSAyIHRoZW4gcmV0dXJuXHJcblx0XHRjb2wgPSBpICUlIDhcclxuXHRcdHJvdyA9IDcgLSBpIC8vIDhcclxuXHRcdHNxID0gZy5jaGVzcy5ib2FyZCgpW3Jvd11bY29sXVxyXG5cdFx0Y29sb3IgPSBcIndiXCJbZy5jaGVzcy5oaXN0b3J5KCkubGVuZ3RoICUlIDJdICMgZsO2cnbDpG50YWQgZsOkcmcgcMOlIHBqw6RzZW5cclxuXHRcdGNzbCA9IEBjbGlja2VkU3F1YXJlcy5sZW5ndGhcclxuXHRcdGlmIGNzbCA9PSAwXHJcblx0XHRcdGlmIHNxICE9IG51bGwgYW5kIHNxLmNvbG9yID09IGNvbG9yIHRoZW4gQGNsaWNrZWRTcXVhcmVzLnB1c2ggaVxyXG5cdFx0ZWxzZSBpZiBjc2wgPT0gMVxyXG5cdFx0XHRpZiBpID09IEBjbGlja2VkU3F1YXJlc1swXSAjIMOlbmdyYSBvbSBzYW1tYSBydXRhXHJcblx0XHRcdFx0QGNsaWNrZWRTcXVhcmVzID0gW11cclxuXHRcdFx0ZWxzZSAjIGtvbnRyb2xsZXJhIGRyYWdldFxyXG5cdFx0XHRcdEBjbGlja2VkU3F1YXJlcy5wdXNoIGlcclxuXHRcdFx0XHR1Y2kgPSB0b1VDSSBAY2xpY2tlZFNxdWFyZXNcclxuXHRcdFx0XHQjIMOkciBkZXR0YSBldHQga29ycmVrdCBkcmFnPyBJIHPDpSBmYWxsLCB1dGbDtnIgZGV0XHJcblx0XHRcdFx0aWYgZy5jaGVzcy5tb3ZlIHtmcm9tOnVjaS5zbGljZSgwLDIpLCB0bzp1Y2kuc2xpY2UoMiw0KX1cclxuXHRcdFx0XHRcdCNpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkIFwibXlJbnB1dFwiXHJcblx0XHRcdFx0XHQjaW5wdXQudmFsdWUgPSBnLmNoZXNzLnBnbigpXHJcblx0XHRcdFx0XHQjY29weVRvQ2xpcGJvYXJkIGcuY2hlc3MucGduKClcclxuXHRcdFx0XHRcdCNuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCBnLmNoZXNzLnBnbigpXHJcblx0XHRcdFx0XHQjaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCBcIm15SW5wdXRcIlxyXG5cclxuXHRcdFx0XHRcdCMgY29weVRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIFwiI215SW5wdXRcIlxyXG5cdFx0XHRcdFx0Zy5wZ24gPSBKU09OLnN0cmluZ2lmeSBnLmNoZXNzLnBnbigpXHJcblxyXG5cdFx0XHRcdFx0QGNsaWNrZWRTcXVhcmVzID0gW11cclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRAY2xpY2tlZFNxdWFyZXMucG9wKClcclxuXHJcblx0ZHJhdyA6ID0+XHJcblxyXG5cdFx0Zm9yIGJ1dHRvbiBpbiBAYnV0dG9uc1xyXG5cdFx0XHRidXR0b24uZHJhdygpXHJcblxyXG5cdFx0ZmlsbCAnd2hpdGUnXHJcblx0XHR0ZXh0U2l6ZSBnbG9iYWwuc2l6ZSgpICogMC4zXHJcblxyXG5cdFx0cHVzaCgpXHJcblx0XHRpZiBAbnI9PTAgdGhlbiB0cmFuc2xhdGUgZ2xvYmFsLm14KCksIGdsb2JhbC5teSgpXHJcblx0XHRlbHNlIHRyYW5zbGF0ZSBnbG9iYWwubXgoKSwgZ2xvYmFsLm15KCkgKyA5ICogZ2xvYmFsLnNpemUoKVxyXG5cclxuXHRcdGZvciBpIGluIHJhbmdlIDhcclxuXHRcdFx0Zm9yIGogaW4gcmFuZ2UgOFxyXG5cdFx0XHRcdHBpZWNlID0gZ2xvYmFsLmNoZXNzLmJvYXJkKClbNy1pXVtqXVxyXG5cdFx0XHRcdHNxID0gQHNxdWFyZXNbaSo4K2pdXHJcblx0XHRcdFx0aWYgQGNsaWNrZWRTcXVhcmVzLmxlbmd0aCBpbiBbMCwyXVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgZmFsc2VcclxuXHRcdFx0XHRpZiBAY2xpY2tlZFNxdWFyZXMubGVuZ3RoIGluIFsxXVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgaSo4K2o9PUBjbGlja2VkU3F1YXJlc1swXVxyXG5cdFx0XHRcdGVsc2UgaWYgQGNsaWNrZWRTcXVhcmVzLmxlbmd0aCBpbiBbMyw0XVxyXG5cdFx0XHRcdFx0c3EuZHJhdyBwaWVjZSwgaSo4K2o9PUBjbGlja2VkU3F1YXJlc1syXVxyXG5cclxuXHRcdHN0cm9rZSAnYmxhY2snXHJcblx0XHRpZiBAbnIgPT0gZ2xvYmFsLmNoZXNzLmhpc3RvcnkoKS5sZW5ndGglMiB0aGVuIGZpbGwgMTI4LDEyOCwxMjgsNjQgZWxzZSBub0ZpbGwoKVxyXG5cdFx0U0laRSA9IGdsb2JhbC5zaXplKClcclxuXHRcdHJlY3QgU0laRSo0LFNJWkUqNCxTSVpFKjgsU0laRSo4XHJcblx0XHRwb3AoKVxyXG5cclxuXHRsaXR0ZXJhIDogPT5cclxuXHRcdFNJWkUgPSBnbG9iYWwuc2l6ZSgpXHJcblx0XHRub1N0cm9rZSgpXHJcblx0XHRmaWxsICdibGFjaydcclxuXHRcdHRleHRTaXplIFNJWkUqMC4zXHJcblx0XHRsZXR0ZXJzID0gaWYgZmFsc2UgdGhlbiBcImhnZmVkY2JhXCIgZWxzZSBcImFiY2RlZmdoXCJcclxuXHRcdGRpZ2l0cyAgPSBpZiBmYWxzZSB0aGVuIFwiMTIzNDU2NzhcIiBlbHNlIFwiODc2NTQzMjFcIlxyXG5cclxuXHRcdGZvciBpIGluIHJhbmdlIDhcclxuXHRcdFx0dGV4dCBsZXR0ZXJzW2ldLFNJWkUqKGkrMSksU0laRSo4LjhcclxuXHRcdFx0dGV4dCBkaWdpdHNbaV0sU0laRSowLjE1LFNJWkUqKGkrMSlcclxuIl19
//# sourceURL=c:\github\2023-026-chessx2\coffee\board.coffee