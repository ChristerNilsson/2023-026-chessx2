// Generated by CoffeeScript 2.5.1
var arr, fullScreen, released, resize, showDialogue;

import _ from 'https://cdn.skypack.dev/lodash';

import {
  ass,
  log,
  range,
  enterFullscreen,
  signal
} from '../js/utils.js';

import {
  Board
} from '../js/board.js';

import {
  Button
} from '../js/button.js';

import {
  global
} from '../js/globals.js';

import {
  menu0
} from '../js/menus.js';

import {
  MenuButton
} from '../js/dialogue.js';

released = true; // prevention of touch bounce

arr = null;

Array.prototype.clear = function() {
  return this.length = 0;
};

window.preload = () => {
  var i, j, len, len1, letter, ref, ref1, results;
  ref = "rnbqkp";
  for (i = 0, len = ref.length; i < len; i++) {
    letter = ref[i];
    global.pics[letter] = loadImage('./images/b' + letter + '.png');
  }
  ref1 = "RNBQKP";
  results = [];
  for (j = 0, len1 = ref1.length; j < len1; j++) {
    letter = ref1[j];
    results.push(global.pics[letter] = loadImage('./images/w' + letter.toLowerCase() + '.png'));
  }
  return results;
};

fullScreen = () => {
  return enterFullscreen();
};

showDialogue = function() {
  if (global.dialogues.length > 0) {
    return (_.last(global.dialogues)).show();
  }
};

window.setup = () => {
  createCanvas(innerWidth, innerHeight);
  [global.size, global.setSize] = signal(round(min(innerWidth, innerHeight) / 18));
  [global.mx, global.setMx] = signal(round((innerWidth - 8 * global.size()) / 2));
  [global.my, global.setMy] = signal(round((innerHeight - 17 * global.size()) / 2));
  resize();
  textAlign(CENTER, CENTER);
  rectMode(CENTER);
  imageMode(CENTER);
  angleMode(DEGREES);
  global.board0 = new Board(0);
  global.board1 = new Board(1);
  return global.chess = new Chess();
};

window.draw = () => {
  var button, i, len, ref;
  background('gray');
  textSize(global.size());
  global.board0.draw();
  global.board1.draw();
  ref = global.buttons;
  for (i = 0, len = ref.length; i < len; i++) {
    button = ref[i];
    button.draw();
  }
  fill("black");
  textAlign(CENTER, CENTER);
  return showDialogue();
};

window.onresize = function() {
  return resize();
};

// window.keyPressed = =>
// 	if global.dialogues.length == 0 then menu0() # else dialogues.clear()
resize = function() {
  global.setSize(round(innerHeight / 18));
  resizeCanvas(innerWidth, innerHeight);
  global.setMx(round((innerWidth - 8 * global.size()) / 2));
  //console.log 'size',global.size()
  global.setMy(round((innerHeight - 17 * global.size()) / 2));
  global.buttons = [];
  global.buttons.push(new MenuButton(round(global.mx() / 2), round(0.80 * height)));
  return global.buttons.push(new MenuButton(round(width - global.mx() / 2), round(0.20 * height)));
};

window.mousePressed = () => {
  var button, i, j, len, len1, ref, ref1, square;
  if (!released) {
    return;
  }
  released = false;
  if (global.dialogues.length === 0) {
    ref = global.buttons;
    //.concat global.buttons
    //console.log 'mousePressed'
    for (i = 0, len = ref.length; i < len; i++) {
      button = ref[i];
      if (button.inside(mouseX, mouseY)) {
        button.onclick();
        return false;
      }
    }
    ref1 = global.board0.squares.concat(global.board1.squares);
    for (j = 0, len1 = ref1.length; j < len1; j++) {
      square = ref1[j];
      if (square.inside(mouseX, mouseY)) {
        //console.log 'square.inside',square.nr
        square.onclick();
        return false;
      }
    }
    return false;
  } else {
    (_.last(global.dialogues)).execute(mouseX, mouseY);
    return false;
  }
};

window.mouseReleased = () => {
  released = true;
  return false;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXHNrZXRjaC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUEsR0FBQSxFQUFBLFVBQUEsRUFBQSxRQUFBLEVBQUEsTUFBQSxFQUFBOztBQUFBLE9BQU8sQ0FBUCxNQUFBOztBQUNBLE9BQUE7RUFBUSxHQUFSO0VBQVksR0FBWjtFQUFnQixLQUFoQjtFQUFzQixlQUF0QjtFQUFzQyxNQUF0QztDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLEtBQVI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxNQUFSO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsTUFBUjtDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLEtBQVI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxVQUFSO0NBQUEsTUFBQTs7QUFFQSxRQUFBLEdBQVcsS0FSWDs7QUFTQSxHQUFBLEdBQU07O0FBQ04sS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFoQixHQUF3QixRQUFBLENBQUEsQ0FBQTtTQUFHLElBQUMsQ0FBQSxNQUFELEdBQVU7QUFBYjs7QUFFeEIsTUFBTSxDQUFDLE9BQVAsR0FBaUIsQ0FBQSxDQUFBLEdBQUE7QUFDakIsTUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUE7QUFBQztFQUFBLEtBQUEscUNBQUE7O0lBQ0MsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFELENBQVgsR0FBc0IsU0FBQSxDQUFVLFlBQUEsR0FBZSxNQUFmLEdBQXdCLE1BQWxDO0VBRHZCO0FBRUE7QUFBQTtFQUFBLEtBQUEsd0NBQUE7O2lCQUNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBRCxDQUFYLEdBQXNCLFNBQUEsQ0FBVSxZQUFBLEdBQWUsTUFBTSxDQUFDLFdBQVAsQ0FBQSxDQUFmLEdBQXNDLE1BQWhEO0VBRHZCLENBQUE7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O1NBQ1g7QUFGc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdodHRwczovL2Nkbi5za3lwYWNrLmRldi9sb2Rhc2gnXHJcbmltcG9ydCB7YXNzLGxvZyxyYW5nZSxlbnRlckZ1bGxzY3JlZW4sc2lnbmFsfSBmcm9tICcuLi9qcy91dGlscy5qcydcclxuaW1wb3J0IHtCb2FyZH0gZnJvbSAnLi4vanMvYm9hcmQuanMnXHJcbmltcG9ydCB7QnV0dG9ufSBmcm9tICcuLi9qcy9idXR0b24uanMnXHJcbmltcG9ydCB7Z2xvYmFsfSBmcm9tICcuLi9qcy9nbG9iYWxzLmpzJ1xyXG5pbXBvcnQge21lbnUwfSBmcm9tICcuLi9qcy9tZW51cy5qcydcclxuaW1wb3J0IHtNZW51QnV0dG9ufSBmcm9tICcuLi9qcy9kaWFsb2d1ZS5qcydcclxuXHJcbnJlbGVhc2VkID0gdHJ1ZSAjIHByZXZlbnRpb24gb2YgdG91Y2ggYm91bmNlXHJcbmFyciA9IG51bGxcclxuQXJyYXkucHJvdG90eXBlLmNsZWFyID0gLT4gQGxlbmd0aCA9IDBcclxuXHJcbndpbmRvdy5wcmVsb2FkID0gPT5cclxuXHRmb3IgbGV0dGVyIGluIFwicm5icWtwXCJcclxuXHRcdGdsb2JhbC5waWNzW2xldHRlcl0gPSBsb2FkSW1hZ2UgJy4vaW1hZ2VzL2InICsgbGV0dGVyICsgJy5wbmcnXHJcblx0Zm9yIGxldHRlciBpbiBcIlJOQlFLUFwiXHJcblx0XHRnbG9iYWwucGljc1tsZXR0ZXJdID0gbG9hZEltYWdlICcuL2ltYWdlcy93JyArIGxldHRlci50b0xvd2VyQ2FzZSgpICsgJy5wbmcnXHJcblxyXG5mdWxsU2NyZWVuID0gPT4gZW50ZXJGdWxsc2NyZWVuKClcclxuXHJcbnNob3dEaWFsb2d1ZSA9IC0+IGlmIGdsb2JhbC5kaWFsb2d1ZXMubGVuZ3RoID4gMCB0aGVuIChfLmxhc3QgZ2xvYmFsLmRpYWxvZ3Vlcykuc2hvdygpXHJcblxyXG53aW5kb3cuc2V0dXAgPSA9PlxyXG5cclxuXHRjcmVhdGVDYW52YXMgaW5uZXJXaWR0aCxpbm5lckhlaWdodFxyXG5cclxuXHRbZ2xvYmFsLnNpemUsIGdsb2JhbC5zZXRTaXplXSA9IHNpZ25hbCByb3VuZCBtaW4oaW5uZXJXaWR0aCxpbm5lckhlaWdodCkvMThcclxuXHRbZ2xvYmFsLm14LCBnbG9iYWwuc2V0TXhdID0gc2lnbmFsIHJvdW5kIChpbm5lcldpZHRoIC0gOCAqIGdsb2JhbC5zaXplKCkpLzJcclxuXHRbZ2xvYmFsLm15LCBnbG9iYWwuc2V0TXldID0gc2lnbmFsIHJvdW5kIChpbm5lckhlaWdodCAtIDE3ICogZ2xvYmFsLnNpemUoKSkvMlxyXG5cclxuXHRyZXNpemUoKVxyXG5cclxuXHR0ZXh0QWxpZ24gQ0VOVEVSLENFTlRFUlxyXG5cdHJlY3RNb2RlIENFTlRFUlxyXG5cdGltYWdlTW9kZSBDRU5URVJcclxuXHRhbmdsZU1vZGUgREVHUkVFU1xyXG5cclxuXHRnbG9iYWwuYm9hcmQwID0gbmV3IEJvYXJkIDBcclxuXHRnbG9iYWwuYm9hcmQxID0gbmV3IEJvYXJkIDFcclxuXHRnbG9iYWwuY2hlc3MgPSBuZXcgQ2hlc3MoKVxyXG5cclxud2luZG93LmRyYXcgPSA9PlxyXG5cdGJhY2tncm91bmQgJ2dyYXknXHJcblx0dGV4dFNpemUgZ2xvYmFsLnNpemUoKVxyXG5cdGdsb2JhbC5ib2FyZDAuZHJhdygpXHJcblx0Z2xvYmFsLmJvYXJkMS5kcmF3KClcclxuXHRmb3IgYnV0dG9uIGluIGdsb2JhbC5idXR0b25zXHJcblx0XHRidXR0b24uZHJhdygpXHJcblx0ZmlsbCBcImJsYWNrXCJcclxuXHR0ZXh0QWxpZ24gQ0VOVEVSLENFTlRFUlxyXG5cdHNob3dEaWFsb2d1ZSgpXHJcblxyXG53aW5kb3cub25yZXNpemUgPSAtPiByZXNpemUoKVxyXG5cclxuIyB3aW5kb3cua2V5UHJlc3NlZCA9ID0+XHJcbiMgXHRpZiBnbG9iYWwuZGlhbG9ndWVzLmxlbmd0aCA9PSAwIHRoZW4gbWVudTAoKSAjIGVsc2UgZGlhbG9ndWVzLmNsZWFyKClcclxuXHJcbnJlc2l6ZSA9IC0+XHJcblx0Z2xvYmFsLnNldFNpemUgcm91bmQgaW5uZXJIZWlnaHQvMThcclxuXHRyZXNpemVDYW52YXMgaW5uZXJXaWR0aCwgaW5uZXJIZWlnaHRcclxuXHRnbG9iYWwuc2V0TXggcm91bmQgKGlubmVyV2lkdGggLSA4ICogZ2xvYmFsLnNpemUoKSkvMlxyXG5cdCNjb25zb2xlLmxvZyAnc2l6ZScsZ2xvYmFsLnNpemUoKVxyXG5cdGdsb2JhbC5zZXRNeSByb3VuZCAoaW5uZXJIZWlnaHQgLSAxNyAqIGdsb2JhbC5zaXplKCkpLzJcclxuXHRnbG9iYWwuYnV0dG9ucyA9IFtdXHJcblx0Z2xvYmFsLmJ1dHRvbnMucHVzaCBuZXcgTWVudUJ1dHRvbiByb3VuZCggICAgICBnbG9iYWwubXgoKS8yKSwgcm91bmQoMC44MCpoZWlnaHQpXHJcblx0Z2xvYmFsLmJ1dHRvbnMucHVzaCBuZXcgTWVudUJ1dHRvbiByb3VuZCh3aWR0aC1nbG9iYWwubXgoKS8yKSwgcm91bmQoMC4yMCpoZWlnaHQpXHJcblxyXG53aW5kb3cubW91c2VQcmVzc2VkID0gPT5cclxuXHRpZiBub3QgcmVsZWFzZWQgdGhlbiByZXR1cm5cclxuXHRyZWxlYXNlZCA9IGZhbHNlXHJcblxyXG5cdGlmIGdsb2JhbC5kaWFsb2d1ZXMubGVuZ3RoID09IDBcclxuXHRcdCNjb25zb2xlLmxvZyAnbW91c2VQcmVzc2VkJ1xyXG5cdFx0Zm9yIGJ1dHRvbiBpbiBnbG9iYWwuYnV0dG9ucyAjLmNvbmNhdCBnbG9iYWwuYnV0dG9uc1xyXG5cdFx0XHRpZiBidXR0b24uaW5zaWRlIG1vdXNlWCxtb3VzZVlcclxuXHRcdFx0XHRidXR0b24ub25jbGljaygpXHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlXHJcblx0XHRmb3Igc3F1YXJlIGluIGdsb2JhbC5ib2FyZDAuc3F1YXJlcy5jb25jYXQgZ2xvYmFsLmJvYXJkMS5zcXVhcmVzXHJcblx0XHRcdGlmIHNxdWFyZS5pbnNpZGUgbW91c2VYLG1vdXNlWVxyXG5cdFx0XHRcdCNjb25zb2xlLmxvZyAnc3F1YXJlLmluc2lkZScsc3F1YXJlLm5yXHJcblx0XHRcdFx0c3F1YXJlLm9uY2xpY2soKVxyXG5cdFx0XHRcdHJldHVybiBmYWxzZVxyXG5cdFx0ZmFsc2VcclxuXHRlbHNlXHJcblx0XHQoXy5sYXN0IGdsb2JhbC5kaWFsb2d1ZXMpLmV4ZWN1dGUgbW91c2VYLG1vdXNlWVxyXG5cdFx0ZmFsc2VcclxuXHJcbndpbmRvdy5tb3VzZVJlbGVhc2VkID0gPT5cclxuXHRyZWxlYXNlZCA9IHRydWVcclxuXHRmYWxzZVxyXG4iXX0=
//# sourceURL=c:\github\2023-026-chessx2\coffee\sketch.coffee